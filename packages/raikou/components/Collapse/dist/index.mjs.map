{"version":3,"sources":["../src/Collapse.tsx","../src/use-collapse.ts"],"sourcesContent":["import React, { forwardRef } from \"react\";\nimport { useReducedMotion } from \"@raikou/hooks\";\nimport {\n  BoxProps,\n  useProps,\n  Box,\n  getStyleObject,\n  useRaikouTheme,\n} from \"@raikou/core\";\nimport { useCollapse } from \"./use-collapse\";\n\nexport interface CollapseProps\n  extends BoxProps,\n    Omit<React.ComponentPropsWithoutRef<\"div\">, keyof BoxProps> {\n  /** Opened state */\n  in: boolean;\n\n  /** Called each time transition ends */\n  onTransitionEnd?: () => void;\n\n  /** Transition duration in ms, `200` by default */\n  transitionDuration?: number;\n\n  /** Transition timing function, default value is `ease` */\n  transitionTimingFunction?: string;\n\n  /** Determines whether opacity should be animated, `true` by default */\n  animateOpacity?: boolean;\n}\n\nconst defaultProps: Partial<CollapseProps> = {\n  transitionDuration: 200,\n  transitionTimingFunction: \"ease\",\n  animateOpacity: true,\n};\n\nexport const Collapse = forwardRef<HTMLDivElement, CollapseProps>(\n  (props, ref) => {\n    const {\n      children,\n      in: opened,\n      transitionDuration,\n      transitionTimingFunction,\n      style,\n      onTransitionEnd,\n      animateOpacity,\n      ...others\n    } = useProps(\"Collapse\", defaultProps, props);\n\n    const theme = useRaikouTheme();\n    const shouldReduceMotion = useReducedMotion();\n    const reduceMotion = theme.respectReducedMotion\n      ? shouldReduceMotion\n      : false;\n    const duration = reduceMotion ? 0 : transitionDuration;\n\n    const getCollapseProps = useCollapse({\n      opened,\n      transitionDuration: duration,\n      transitionTimingFunction,\n      onTransitionEnd,\n    });\n\n    if (duration === 0) {\n      return opened ? <Box {...others}>{children}</Box> : null;\n    }\n\n    return (\n      <Box\n        {...getCollapseProps({\n          style: getStyleObject(style, theme),\n          ref,\n          ...others,\n        })}\n      >\n        <div\n          style={{\n            opacity: opened || !animateOpacity ? 1 : 0,\n            transition: animateOpacity\n              ? `opacity ${duration}ms ${transitionTimingFunction}`\n              : \"none\",\n          }}\n        >\n          {children}\n        </div>\n      </Box>\n    );\n  },\n);\n\nCollapse.displayName = \"@raikou/core/Collapse\";\n","import React, { useState, useRef } from \"react\";\nimport { flushSync } from \"react-dom\";\nimport { useDidUpdate, mergeRefs } from \"@raikou/hooks\";\nimport { CSSProperties } from \"../../Box/src\";\n\nfunction getAutoHeightDuration(height: number | string) {\n  if (!height || typeof height === \"string\") {\n    return 0;\n  }\n  const constant = height / 36;\n  return Math.round((4 + 15 * constant ** 0.25 + constant / 5) * 10);\n}\n\nexport function getElementHeight(\n  el: React.RefObject<HTMLElement> | { current?: { scrollHeight: number } },\n) {\n  return el?.current ? el.current.scrollHeight : \"auto\";\n}\n\nconst raf = typeof window !== \"undefined\" && window.requestAnimationFrame;\n\ninterface UseCollapse {\n  opened: boolean;\n  transitionDuration?: number;\n  transitionTimingFunction?: string;\n  onTransitionEnd?: () => void;\n}\n\ninterface GetCollapseProps {\n  [key: string]: unknown;\n  style?: CSSProperties;\n  onTransitionEnd?: (e: TransitionEvent) => void;\n  refKey?: string;\n  ref?: React.ForwardedRef<HTMLDivElement>;\n}\n\nexport function useCollapse({\n  transitionDuration,\n  transitionTimingFunction = \"ease\",\n  onTransitionEnd = () => {},\n  opened,\n}: UseCollapse): (props: GetCollapseProps) => Record<string, any> {\n  const el = useRef<HTMLElement | null>(null);\n  const collapsedHeight = 0;\n  const collapsedStyles = {\n    display: \"none\",\n    height: 0,\n    overflow: \"hidden\",\n  };\n  const [styles, setStylesRaw] = useState<CSSProperties>(\n    opened ? {} : collapsedStyles,\n  );\n  const setStyles = (newStyles: {} | ((oldStyles: {}) => {})): void => {\n    flushSync(() => setStylesRaw(newStyles));\n  };\n\n  const mergeStyles = (newStyles: {}): void => {\n    setStyles((oldStyles) => ({ ...oldStyles, ...newStyles }));\n  };\n\n  function getTransitionStyles(height: number | string): {\n    transition: string;\n  } {\n    const _duration = transitionDuration || getAutoHeightDuration(height);\n    return {\n      transition: `height ${_duration}ms ${transitionTimingFunction}`,\n    };\n  }\n\n  useDidUpdate(() => {\n    if (typeof raf === \"function\") {\n      if (opened) {\n        raf(() => {\n          mergeStyles({\n            willChange: \"height\",\n            display: \"block\",\n            overflow: \"hidden\",\n          });\n          raf(() => {\n            const height = getElementHeight(el);\n            mergeStyles({ ...getTransitionStyles(height), height });\n          });\n        });\n      } else {\n        raf(() => {\n          const height = getElementHeight(el);\n          mergeStyles({\n            ...getTransitionStyles(height),\n            willChange: \"height\",\n            height,\n          });\n          raf(() =>\n            mergeStyles({ height: collapsedHeight, overflow: \"hidden\" }),\n          );\n        });\n      }\n    }\n  }, [opened]);\n\n  const handleTransitionEnd = (e: React.TransitionEvent): void => {\n    if (e.target !== el.current || e.propertyName !== \"height\") {\n      return;\n    }\n\n    if (opened) {\n      const height = getElementHeight(el);\n\n      if (height === styles.height) {\n        setStyles({});\n      } else {\n        mergeStyles({ height });\n      }\n\n      onTransitionEnd();\n    } else if (styles.height === collapsedHeight) {\n      setStyles(collapsedStyles);\n      onTransitionEnd();\n    }\n  };\n\n  function getCollapseProps({\n    style = {},\n    refKey = \"ref\",\n    ...rest\n  }: GetCollapseProps = {}) {\n    const theirRef: any = rest[refKey];\n    return {\n      \"aria-hidden\": !opened,\n      ...rest,\n      [refKey]: mergeRefs(el, theirRef),\n      onTransitionEnd: handleTransitionEnd,\n      style: { boxSizing: \"border-box\", ...style, ...styles },\n    };\n  }\n\n  return getCollapseProps;\n}\n"],"mappings":"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","names":["React","React"]}